## インターネット不要！ どこでもオフライン地図サーバ
災害発生時、インターネット接続ができない状況で災害対応システムとして利活用することができるオープンソース・ウェブ地図サーバーである。
<img width="465" alt="スクリーンショット 2022-02-09 16 16 32" src="https://user-images.githubusercontent.com/29940264/153140557-7d85fe0a-7b5d-4d08-8ea9-6cb8fb7da55c.png">

本作品はUNVT Portableという名称で[国連OpenGIS Initiative WG4](http://unopengis.org/unopengis/main/main.php) 公式の技術として採用されている。
## 開発背景
地理情報システム（Geographic Information System; 以下 GIS）は自然災害における災害対応の場面で利活用されており、国内では 1995 年 兵庫県南部地震以降、国外では 2010 年 ハイチ地震を皮切りにその事例及び、研究が蓄積されてきた。災害発生直後、被害軽減のためには、自治体等の災害対策本部が GIS を用いて、現地の状況をいち早く把握し、的確な災害対応を実現することが重要である。これまでに、災害直後の対策を支援する GIS ツールや技術は数多く研究されてきた。先行研究を俯瞰してみると、災害直後の状況把握をするため手法として Web-GISが用いられていることがわかった。つまり、災害直後の現場把握を行う際にはインターネット環境があり、それにアクセスできることが前提とされている。2010 年 ハイチ地震発生時、ネットにアクセスできるハイチ人は国民全体の 11%であった。2022 年 トンガの海底火山噴火では、海底ケーブルが切断され、インターネット環境から断絶する事態も起きた。災害発生時には往々にしてインターネットに接続できない状況が発生するにも関わらず、オフライン環境前提として、GIS を活用する災害対応システムの提案はなされていない。そこで本作品は、自治体等の災害対策本部がオフライン環境前提として利活用することができるツールとして開発を行った。

## 開発手法
オフライン環境でも機能する GIS ツールを制作するために、The United Nations Vector Tile Toolkit（以下 国連UNVT)をアップグレードする形で開発を行った。国連UNVT は [UN Open GIS Initiative](http://unopengis.org/unopengis/main/main.php)のプロジェクトの 1 つとして採択されており、地図の整備が不十分な国の地域のデジタル地図の拡充を目的としたオープンソースのプロジェクトである。国連UNVT技術をアップグレードさせ、Raspberry Pi を用いたオフライン環境下で動くオープンソース・ウェブ地図サーバー（以下 UNVT Portable）を完成させ、インターネットが無い環境でも災害対策本部が GIS を用いた災害対応を行うことを可能にした。以下に、UNVT Portable の実装工程を記述する。

次の 3 つの工程に分けて実装を行った。1.UNVT Portabl アクセスポイント化 2.タイルデータの制作 3.html ファイルの実装。この順番に沿って、各実装の詳細を紹介する。

> UNVT Portabl アクセスポイント化

Mac と UNVT Portable を Ethernet ケーブルで有線接続している状態で、実装に着手した。まず、以下のパッケージ 5 つ（apatch2、hostapd、dnsmasq、isc-dhcp-server、rng-tools）をインストールし、その後に UNVT Portable の IP アドレスの固定化、Wi-Fi の SSID と Pass の設定を行った。QR コード読み取りによる Wi-Fi 接続とページ閲覧の簡便化も行い、特別な知識のない人でも、自分の所有する端末を用いて、オフライン環境下でデジタル地図をスマホや PC で閲覧可能とさせた。   

<img width="940" alt="スクリーンショット 2022-02-09 16 02 32" src="https://user-images.githubusercontent.com/29940264/153138684-026eb92a-fd67-4e9b-a31d-9b3412699395.png">


- QRコードでの読み取りデモ
SSIDを"dronebird"で設定してデモを行った。   
https://user-images.githubusercontent.com/29940264/153139465-3033a4c4-cc60-4222-9813-fcf16d520424.mp4

> タイルデータの制作

二子玉川駅付近の Web 地図を制作した。本マップを表示するにあたり、次の 4 つのタイルデータ（道路ベクトルタイル・建物ベクトルタイル・二子玉川の空撮ラスタータイル・世田谷区避難所ベクトルタイル）を制作した。道路ベクトルタイル・建物ベクトルタイルは OpenStreetMap、二子玉川の空撮ラスタータイルは OpenAerialMap、世田谷区避難所ベクトルタイルは東京都オープンデータカタログサイトからデータを引用し、それを UNVT にも採用されているオープンソースソフトの Tippicanue で用いてタイル化を行った。

> html ファイルの実装 
  
オフラインで機能する Web 地図アプリケーションを作成するため、[MapLibre GL JS](https://maplibre.org/) を使い実装を行った。上記で記載した、各タイルを Source レイヤーで指定し、道路ベクトルタイル・建物ベクトルタイル・二子玉川の空撮ラスタータイル・世田谷区避難所ベクトルタイルの順で記述し、避難所データが最前面となるよう Layers レイヤーに記述した。避難所のポイントデータは画像としてで表示させた。デモは[こちら](https://furuhashilab.github.io/2021gsc_ShogoHirasawa/)から。   
<img width="792" alt="スクリーンショット 2022-02-09 16 12 25" src="https://user-images.githubusercontent.com/29940264/153140004-26484fe0-78de-4773-897d-11ee31ea7ded.png">


## 今後の展望
Web-GIS はインターネット接続がある環境で、前もってデータをダウンロードしておけば、オフラインで使える災害対応システムとして利活用することができる。本作品は、UNVT Portable を活用すると想定される自治体や行政職員に前もったダウンロード作業を必要とさせておらず、また QR コードの読み取りだけで Web 地図を見ることができ、使用する上で専門的な知識を必要としない点が先行研究と差別化できる点である。災害直後はインターネット接続を前提とした Web-GIS を用いた災害対応を行いつつも、オフラインとなった時のバックアップツールとして、UNVT Portable を活用していくことで、災害直後の対応がより迅速に行えることができると期待する。また、オープンデータや行政のデータの組み合わせを変えていくことで、その時々にあったオフラインマップを自由に作ることができる。災害支援目的のみならず、インターネットが使えない僻地での業務にも活用することができる。

## 課題
UNVTPortable としての現状の完成度は 80%程であると考える。ウェブ地図サーバーとして機能させるために毎回、コマンド入力が必要なため、コマンド入力を不要にさせ、電源を入れるだけでサーバーとして機能させることがゴールである。併せて、東京都をテキストエリアとして、行政が公開するオープンデータと、ベースマップとしての OpenStreetMap データを組み合わせ、プリインストールデータセットの試作も必要である。今後、国連と連携をとりながら、本作品の完成度完成を向上させていく。

## 実績
- UN-GGIM WG-Disasters TG-B meeting登壇
- 都知事杯OpenDataHackathon 出場
- Tokyo OSS Party!! 2021 出場
- FOSS4G SotM Oceania 登壇


